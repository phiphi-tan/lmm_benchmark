from ..util.benchmark_tools import run_benchmark, get_omni_predictions, split_inputs, split_prompts
from ..util.displays import show_individual, show_differences, show_results
from ..util.benchmark_models import get_models
from datasets import load_dataset
from transformers import pipeline
import torch
from PIL import Image

#----- hyperparameters -----

models = get_models()

dataset_path = "Naveengo/flickr8k"
dataset_split = "train"
sample_size = 3
data_info = [dataset_path, dataset_split, sample_size]

system_prompt = "Your task is to evaluate and rate candidate captions on a scale of 0.0 to 1.0 based on the given Grading Criteria. " \
        "(Print Real Number Score ONLY) \n" \
        "Grading Criteria:"\
        "0.0: The caption does not describe the image at all."\
        "1.0: The caption accurately and clearly describes the image."
	

global_user_prompt = "Reference Caption: {ref}\n "\
        "Candidate Captions: {cand}\n" \
        "Score (Print a list of ONLY the decimal number): "

generated_captions = {
        "google/gemma-3-4b-it":['Children playing soccer in a sandy field.', 'Man reading on a subway train', 'Black and white dog walking on the beach', 'Two dogs running on a grassy hill.', 'Snowboarder in mid-air over a snow ramp.', 'Golden retriever in water', 'Snowmobile on a snowy trail.', 'Two young girls playing together.', 'Two men on a mountain peak with a scenic view.', 'A boy sledding through deep snow.', 'People viewing a wall installation of portraits and lights.', 'Boys performing acrobatics on a trampoline outdoors.', 'Greyhounds racing at night.', 'A skier on a snowy slope.', 'Red dog running through waves.', 'Fencers practicing in a gymnasium.', 'Girl eating ice cream while sitting on a bicycle.', 'German Shepherd running on grass', 'A young person hanging upside down from a tree branch.', 'Skater jumps on a bridge.', 'Mountain biker riding through a forest.', 'Golden retriever running in the grass.', 'Boy eating ice cream cone outdoors.', 'Child skiing on a snowy trail', 'Two men walk along a path towards the ocean.', 'Baby eating yogurt with a spoon.', 'A young girl playing a guitar in a pink bedroom.', 'A black and white dog walking through the snow.', 'Dog in a yard covered in leaves', 'White dog running in a grassy field with a muzzle and collar.', 'A group of people posing with a large gray geometric shape in front of a building.', 'Football players stretching on the field.', 'Two women walking on a city street.', 'Man climbing a rock wall.', 'Motocross rider on a muddy trail.', 'A mouse and a badger costume are embracing in a public square with people in the background.', 'A woman and a man walking on a sidewalk.', 'Crowd at a concert raising their hands.', 'Muddy off-road vehicle stuck in the dirt.', 'Dog catching a frisbee in mid-air.', 'A man kayaking on a blue water surface.', 'Four dogs running through snow-covered grass.', 'Three children playing on a balustrade with a green ball.', 'Two men rappelling down a waterfall.', 'A girl jumping in the air outdoors.', 'Basketball player shooting a ball through the hoop.', 'A tan dog digging in the sand.', 'Two women in traditional kimonos and elaborate hairstyles walking on a stone pavement.', 'People walking past arches in a building.', 'A woman in a red devil costume poses next to a large, illuminated pillar at night.', 'Two children running through a fern garden.', 'Older man speaking into a microphone, with a younger man listening intently.', 'Skateboarder in mid-air on a steep hill.', 'Two girls wading in the water by a lake.', 'A golden retriever jumps over a brick wall.', 'Man cooking outdoors on a wooden bench.', 'Rock climber on a large rock at dusk.', 'Woman pointing with a hand.', 'A woman in a clown costume poses in a park with people in the background.', 'Boys playing soccer on a green field.', 'Two young girls in hats and dresses stand near a large tree on a grassy lawn.', 'Greyhounds racing at night.', 'Two figures with black balloons on a desert hillside under a blue sky.', 'Skater jumping over a building.'],
        "llava-hf/llava-interleave-qwen-7b-hf":['A group of young boys playing soccer in a dusty field.', 'A man in a suit reading a book on a subway.', 'A black and white dog walking on the beach.', 'Two dogs running through a field of tall grass.', 'A snowboarder in a blue jacket and orange pants is in mid-air, performing a jump off a snow ramp.', 'A wet golden retriever enjoying a swim in the water.', 'A person riding a snowmobile in the snow.', 'Two young girls are playing in a hallway.', 'Two people wearing red helmets and black clothing sit on a rocky outcrop, smiling and looking at the camera, with a scenic mountain landscape and a lake', 'A young child is having fun in the snow, creating a big snow cloud around them.', 'Two people standing in front of a wall with a unique light installation featuring multiple faces.', 'A shirtless man doing a flip on a trampoline while others watch.', 'A group of greyhound dogs racing at night.', 'A man in a red jacket skiing down a snowy slope.', 'A dog splashing in the water.', 'Two fencers in protective gear spar in an indoor gym.', 'A young girl sitting on a bench, eating an ice cream, with her bicycle laying on the ground next to her.', 'A German Shepherd dog running through a grassy field.', 'A person hanging upside down from a tree branch.', 'A person on a skateboard jumping over a bridge.', 'A man riding a bike through a forest.', 'A golden retriever dog running through a field of grass.', 'A young boy enjoying a cone of ice cream.', 'A young child skiing down a snowy slope.', 'Two people standing on a rocky cliff overlooking the ocean.', 'A baby with a bib sitting in a high chair, eating and making a mess.', 'A young girl playing a guitar in a bedroom.', 'A black and white dog walking through the snow.', 'A dog playing in a garden with autumn leaves.', 'A white dog running through a grassy field.', 'A group of people posing for a photo in front of a building.', 'A group of football players in red and white uniforms are stretching on the field.', 'Two women walking together on a city street.', 'A man in a brown shirt and blue shorts is climbing a rock wall.', 'A person riding a dirt bike through a river.', 'A man in a mouse costume and a man in a badger costume are dancing together in a public square.', 'A man and woman stand on a street corner, with the woman smiling and the man looking at her.', 'A young girl with her hand raised at a concert.', 'A person in a red helmet is hanging out of a derailed car in a muddy field.', 'A black and white dog catching a frisbee in mid-air.', 'A man paddling a red kayak on a body of water.', 'A group of dogs running through the snow.', 'Three children playing with a ball in front of a building.', 'Two men in swim trunks climbing a waterfall.', 'A young girl jumping in the air with her arms raised.', 'Two men playing basketball on a sunny day.', 'A dog digging into the sand.', 'Two women in traditional Japanese kimonos walking down a stone path.', 'A group of people walking past ornate arches in a building.', 'A woman in a red costume with horns, standing next to a fountain at night.', 'Two children running through a lush garden.', 'Two men are talking on a street. One man is wearing a blue hat and a racing suit with "ZANAZZI" written on it', 'A skateboarder in mid-air after launching off a ramp.', 'Two girls in the water, one in a red swimsuit and the other in a pink one, talking to each other.', 'A dog jumping over a brick wall.', 'A man in a red jacket and hat is sitting on a bench in a grassy area, cooking something on a portable stove.', 'A climber ascends a large rock face at night, illuminated by a single light source.', 'An older woman with short curly hair, wearing a striped shirt, is speaking and gesturing with her hand.', 'A clown with red face paint and a red tie stands in a park, while two people sit on the grass.', 'A young boy playing soccer on a field.', 'Two young girls stand under a tree, wearing dresses and hats, looking at something in the grass.', 'A group of greyhound dogs racing at night.', 'Two people in desert with balloons on their heads.', 'A skateboarder performing a trick in mid-air.'],
        "llava-hf/llava-onevision-qwen2-7b-ov-hf":['A group of young boys playing soccer on a dirt field.', 'A man in a suit reading a book on a subway.', 'A black and white dog walking on a beach.', 'Two dogs running through a field of grass.', 'A snowboarder is in the air after going off a ramp.', 'A wet dog is standing in the water.', 'A group of people riding snowmobiles on a snow covered trail.', 'A little girl is playing with her hair.', 'Two men in red helmets sitting on a mountain.', 'A boy is sitting in the snow.', 'A wall with many pictures of faces and lights.', 'A man flying through the air while doing a trick on a trampoline.', 'A group of dogs running on a track at night.', 'A man riding skis down a snow covered slope.', 'A dog is running through the water.', 'Two people are fencing in a gym.', 'A girl sitting on a bike on a bench eating a popsicle.', 'A dog running on a grassy field.', 'A woman hanging upside down from a tree branch.', 'A skateboarder is jumping in the air on a bridge.', 'A man riding a bike down a hill.', 'A dog running through a field of grass.', 'A young boy eating an ice cream cone.', 'A young child is skiing on a snowy surface.', 'Two people standing on a stairway overlooking the ocean.', 'A baby girl sitting in a high chair eating something.', 'A young girl playing a guitar in a pink room.', 'A dog walking on a snow covered surface.', 'A dog walking through a yard covered in leaves.', 'A white dog running through a grassy field.', 'A group of people posing for a picture in front of a house.', 'Football players are laying on the ground while a coach is talking to them.', 'Two women walking down a sidewalk next to a street.', 'A man climbing a rock wall with his hands.', 'A man riding a motorcycle through a stream.', 'A man in a rat costume and a man in a badger costume walk down a street.', 'A woman and a man walking down a street.', 'A crowd of people with their hands in the air.', 'A red and white truck is turned upside down in the dirt.', 'A dog catching a frisbee in a field.', 'A man in a blue life jacket paddling a red kayak.', 'Four dogs running through a snow covered field.', 'Three children play with a ball on a stone wall.', 'Two men climbing a waterfall with ropes and helmets.', 'A woman jumping in the air with her arms up.', 'A man jumping up to catch a basketball.', 'A dog digs a hole in the sand.', 'Two women in traditional Japanese clothing walking down a street.', 'A group of people walking in front of a building.', 'A woman in a red devil costume posing in front of a fountain.', 'Two children running through a lush green forest.', 'A man is being interviewed by a reporter.', 'A man flying through the air while riding a skateboard.', 'Two girls in bathing suits standing in a lake.', 'A dog jumping over a brick wall.', 'A man sitting on a bench cooking food.', 'A man climbing a rock face in the dark.', 'A woman with short hair wearing a striped shirt.', 'A clown standing in a park with people sitting on the ground.', 'A boy in a green shirt playing soccer.', 'Two little girls standing next to a tree.', 'Two greyhounds race around a track at night.', 'A man with a bunch of balloons on his head.', 'A man flying through the air while riding a skateboard.'],
        "llava-hf/llava-v1.6-mistral-7b-hf":[' "A group of children playing soccer in a dusty field under a clear sky." ', ' "A man engrossed in a book while commuting." ', ' A black and white dog walking on a wet beach. ', ' Two dogs running through a grassy field. ', ' "A snowboarder soaring high above a snowy hill." ', ' "A golden retriever enjoying a refreshing swim in the water." ', ' "A group of snowmobilers enjoying a winter ride through a snowy landscape." ', ' "Two young girls in a hallway, one with a red shirt and the other with a blue headband, both smiling and looking towards the camera."', ' "Two climbers on a mountain peak, enjoying the thrill of the adventure." ', ' A child is having fun in the snow, making a snow angel. ', ' "Two people observing a wall adorned with a unique light installation featuring silhouettes of faces." ', ' "A daring display of acrobatics in a park setting." ', ' "A thrilling dog race under the night sky." ', ' A man skiing down a snowy slope. ', ' A brown dog swimming in the ocean. ', ' Two people engaged in a fencing match. ', ' Girl enjoying a popsicle on a sunny day. ', ' "A German Shepherd in mid-run, showcasing its agility and strength." ', ' "A child\'s joy and freedom, captured in a moment of playful abandon." ', ' "Skateboarder in mid-air, performing a trick on a bridge." ', ' A man riding a bicycle through a forested area. ', ' A golden retriever in mid-air, running through a grassy field. ', ' A young boy enjoying a delicious ice cream cone. ', ' A young skier on a snowy slope. ', ' "Two people taking a moment to enjoy the ocean view from a cliffside walkway." ', ' "A young child enjoying a messy snack time." ', ' "A young girl immersed in the world of music, playing a guitar in her cozy bedroom." ', ' A black and white dog standing on a snowy surface. ', ' A curious dog exploring a garden. ', ' A white dog with a muzzle running through a grassy field. ', ' "A group of people posing for a photo in front of a building, with one person playfully making a peace sign." ', ' "Football players practicing stretches on the field under the guidance of a coach." ', ' Two women walking down a street. ', ' A man is climbing a rock face, gripping the rock with both hands. ', ' "Adventure on the trail: A rider navigates a rocky stream with their dirt bike." ', ' "A lively street scene with a pair of costumed characters, possibly mascots, engaging with the crowd." ', ' "Two people walking on a city street, with one carrying a backpack and smiling at the camera." ', ' "A lively concert scene with a crowd of people, a young girl in a red dress raising her hand, and a man in the foreground', ' "A rollover accident with a person trapped inside a vehicle, surrounded by onlookers." ', ' "A black and white dog in mid-air, catching a frisbee in its mouth." ', ' "Man in sunglasses paddling a red kayak on the water." ', ' "A lively scene of four dogs running through a snowy field." ', ' "Children enjoying a sunny day at the park, playing with a ball and posing for a photo in front of a grand building." ', ' Two men are rappelling down a waterfall, holding onto ropes and wearing helmets for safety. ', ' Girl in mid-air, jumping with joy. ', ' "A dynamic basketball game in progress under a clear sky." ', ' "A dog in mid-dig, exploring the sandy terrain with its nose to the ground." ', ' Two women in traditional Japanese attire, descending a stone staircase. ', ' "A group of people walking past an ornate building with arched doorways." ', ' "A woman in a devil costume, holding a pitchfork, standing in front of a fountain at night." ', ' Two children playing in a lush green garden. ', ' "Two men engaged in a conversation, one wearing a blue hat and a blue and orange jacket, the other in a brown jacket and a scarf', ' Skateboarder performing a daring trick on a yellow and black ramp. ', ' "Two children enjoying a day at the lake, sharing a playful moment in the water." ', ' "A playful dog leaping into the air with its tongue out, seemingly in mid-air above a brick wall." ', ' "A man enjoying a meal in a serene outdoor setting." ', ' A person climbing a rock face at night. ', ' "A woman with curly hair, wearing a striped shirt, stands outdoors with a pink bag in the background." ', ' "A clown in a park, striking a pose with a red nose and a striped tie." ', ' "A group of young boys playing soccer on a grassy field." ', ' Two children standing in a grassy area, wearing matching dresses and hats, with a large tree trunk in the foreground. ', ' "Two greyhounds in a race, one in the lead with a green jersey, the other in pursuit." ', ' "Two figures in black attire, one with a headpiece of numerous black spheres, stand on a rocky hillside under a clear blue', ' "Skateboarder in mid-air, performing a trick over a brick wall." '],
        "Qwen/Qwen2.5-VL-7B-Instruct":['Children play soccer on a dirt field under a bright blue sky.', 'A man in a suit and tie reads a book on a crowded subway train.', 'A black and white dog wades through shallow water on a beach.', 'Two dogs playfully chase each other across a grassy field on a sunny day.', 'Snowboarder in mid-air against a snowy mountain backdrop.', 'A golden retriever shakes off water in a playful splash.', 'Snowmobile adventure through a serene winter landscape.', "Two children playfully interact in a hallway, one adjusting the other's hair.", 'Two climbers on a rocky mountain peak, surrounded by lush green valleys and a distant lake.', 'A child sleds down a snowy hill, creating a cloud of snow behind them.', 'A wall installation featuring portraits illuminated by string lights creates a dramatic and artistic display.', 'A young man performs a backflip on a trampoline while others watch in the background.', 'Greyhounds race fiercely on a dirt track at night.', 'A skier in red and black gear descends a snowy slope.', 'A golden retriever runs through the water, creating splashes.', 'Two fencers in action, one leaping while both engage in a dynamic duel.', 'A young girl sits on a bench beside her bicycle, blowing into a flute.', 'A German Shepherd dog runs energetically across a grassy field.', 'A person in red hangs upside down from tree branches, surrounded by lush greenery.', 'Skateboarder in mid-air on a graffiti-covered bridge.', 'A cyclist speeds through a forested trail, surrounded by lush greenery.', 'A golden retriever runs energetically across a lush green lawn.', 'A child enjoys a creamy ice cream cone outdoors on a sunny day.', 'A child skiing on a snowy trail, dressed in winter gear and holding ski poles.', 'Two individuals walk along a narrow path beside a railing overlooking rugged coastal cliffs and crashing waves.', 'A toddler sits in a high chair, holding a small packet of food, with a playful expression and a bit of food on their hand.', 'A young person plays a guitar in a cozy bedroom adorned with pink floral decorations.', 'A dog stands amidst snow-covered rocks and trees in a serene winter scene.', 'A playful dog explores a leaf-strewn garden.', 'A white dog in motion, wearing a muzzle, runs across a grassy field.', 'A group of people posing playfully in front of a house on a grassy lawn.', "Football players in red and white uniforms stretch on the field under a coach's guidance.", 'Two individuals walk together on a street lined with trees and traffic signs.', 'A climber ascends a rock face, gripping a hold with determination.', 'A motocross rider navigates through a rocky stream in rugged terrain.', '"Costumed characters in a lively street performance."', 'A woman with a backpack smiles as she walks alongside a man on a city street.', 'A lively crowd at a concert, hands raised in excitement.', 'A red and white Mitsubishi truck flips over in a muddy terrain during a race or off-road event.', 'A dog leaps mid-air, catching a frisbee in a grassy field.', 'A kayaker paddles a red "Necky" kayak on calm waters.', 'Four dogs playfully chase each other across a snowy field.', 'Three children play with a green ball in front of a grand building.', 'Two individuals rappel down a waterfall, secured by ropes and helmets.', 'A person in mid-air, arms raised, wearing a blue tank top and light-colored pants, on a sandy ground with a fence and trees in the', 'A basketball player leaps to dunk as another player defends during an outdoor game under a clear blue sky.', 'A dog digs enthusiastically in sandy dunes.', 'Two individuals in traditional Japanese attire walk down stone steps, adorned with intricate hair ornaments and vibrant kimonos.', 'Tourists explore intricate arches and columns in a historic setting.', 'A woman in a red bikini and devil horns poses confidently by a large, striped sculpture at night.', 'Two children run through a lush, green garden pathway.', 'A man in a blue cap and jacket speaks into a microphone while another person listens attentively.', 'A skateboarder soars above a yellow-striped ramp amidst rocky terrain under a cloudy sky.', 'Two individuals in swimwear stand in shallow water near a sandy shore, surrounded by trees and a fenced area.', 'A playful dog leaps mid-air near a garden bed and a decorative planter.', 'A person in a red jacket sits on a bench outdoors, cooking food over a portable stove surrounded by greenery.', 'A climber ascends a large rock formation under a twilight sky.', 'A woman in a striped shirt gestures with her hand while speaking.', 'A person in a red outfit with striped pants and tie stands on a platform, surrounded by spectators in a park setting.', 'A soccer player in action, kicking the ball near the goalpost on a sunny day.', 'Two young girls in matching blue dresses and bonnets stand under a large tree on a sunny day.', 'Greyhounds race on a dirt track at night.', 'Two figures in black suits adorned with large black balloons stand on a rocky landscape under a bright blue sky.', 'Skateboarder mid-air over a brick wall at sunset.'],
        "Qwen/Qwen2.5-Omni-7B":['Children playing soccer on a dirt field under a bright blue sky.', 'A man in a suit reads a book on a crowded subway train.', 'A wet dog trots along the shoreline.', 'Two dogs run across a grassy field with a line of trees in the background.', 'A snowboarder soars through the air above a snowy jump on a bright, clear day', 'A golden retriever shakes off water after a swim.', 'Two snowmobiles are traveling on a snowy trail in a forested area.', 'Two children in festive attire playfully interact in a warmly lit hallway.', 'Two climbers enjoy the view from a mountain peak.', 'A child enjoys a snowy day, tumbling through fresh powder.', 'Two people stand in front of a wall adorned with portraits and illuminated by string lights.', 'A shirtless man performs a backflip on a trampoline while others watch.', 'Greyhounds race on a dirt track at night.', 'A skier in a red jacket glides down a snowy slope.', 'A dog runs through shallow water, splashing as it moves forward.', 'Two fencers engage in a dynamic match, one leaping mid-air with their sword extended.', 'A child enjoys an ice cream while sitting on a bench with a bicycle nearby.', 'A German Shepherd runs energetically across a grassy field.', 'A person hangs upside down from a tree branch in a park.', 'A skateboarder performs a trick on a bridge with graffiti on the ground.', 'A cyclist rides through a lush, green forest.', 'A golden retriever runs energetically across a lush green lawn.', 'A young boy enjoys a melting ice cream cone on a sunny day.', 'A child enjoys skiing on a snowy slope, dressed warmly in a purple jacket and blue pants.', 'Two individuals stand on a narrow pathway with a scenic ocean view.', 'A young child enjoys a treat while sitting in a high chair.', 'A child plays a silver electric guitar in a pink bedroom.', 'A black and white dog walks through a snowy landscape.', 'A black dog explores a leaf-covered backyard near potted plants and a white fence.', 'A white dog wearing a muzzle runs energetically across a grassy field.', 'A group of people posing playfully in front of a building.', 'Football players stretch on the field under the guidance of a coach.', 'Two women walking together on a street with autumn leaves in the background.', 'A person climbs a rock wall outdoors.', 'A cyclist navigates a rocky stream during a mountain biking race.', 'Two people dressed in animal costumes, a kangaroo and a badger, are entertain a crowd on a city street.', 'A woman smiles over her shoulder as she walks with a man on a city street.', 'A crowd of people at a concert, with one person in a red floral dress raising their hands.', 'A red and white Mitsubishi truck is overturned in the dirt, with a driver wearing a red helmet and a yellow shirt.', 'A black and white dog leaps through the air, catching a colorful frisbee in its mouth.', 'A person paddles a red kayak on the water.', 'Four dogs running through a snowy field.', 'Four children play with a green ball on a stone wall in front of a large building.', 'Two individuals rappel down a cascading waterfall.', 'A person jumps joyfully in a sandy arena, arms raised and boots off the ground.', 'A basketball player leaps for a shot during an outdoor game.', 'A dog digs energetically in the sand near tall grass.', 'Two individuals dressed in traditional attire with floral headpieces are seated on stone steps.', 'Tourists stroll past intricately carved columns in a historic setting.', 'A person dressed in a red devil costume poses with a pitchfork in front of a glowing, cylindrical sculpture at night.', 'Two children playfully run through a lush, fern-filled garden.', 'A man in a blue cap and jacket is being interviewed by another man holding a microphone.', 'A skateboarder performs a trick over a yellow and black striped ramp.', 'Two children in swimsuits stand in shallow water, facing each other.', 'A dog leaps energetically over a brick wall in a backyard.', 'A person in a red jacket and white shorts sits on a wooden bench surrounded by greenery, holdinging a thermos and a pot.', 'A climber ascends a large rock formation under a dark, starry sky.', 'A woman in a striped shirt gestures with her hand.', 'A person dressed in a red outfit and tie stands in a park, surrounded by seated individuals.', 'A soccer player kicks the ball towards the goal.', 'Two children in matching dresses and bonnets stand near a tree in a grassy area.', 'Greyhounds race on a track at night.', 'Two figures in black suits and helmets with large black balloons in a desert landscape.', 'A skateboarder performs a trick mid-air over a brick wall.'],
}


#----- data preparation function -----

# must return input images (PIL), question list, reference list
def prep_data(ds_path, ds_split, split_size=None):
    ds = load_dataset(ds_path, split=ds_split)

    if split_size is not None:
        shuffled_ds = ds.shuffle(seed=split_size) # for random selection
        input_dataset = shuffled_ds.select(range(split_size))
    else: 
        input_dataset = ds

    image_list = input_dataset['image'] # get list of images
    question_data_list = [] # get list of questions (if necessary)
    answer_data_list = input_dataset['text'] # get list of answers

    return image_list, question_data_list, answer_data_list 

#----- benchmarks -----
# DO NOT EDIT

def all_model_caption(i):
    return_list = []
    for model, pred in generated_captions.items():
        return_list.append(pred[i])
    print(return_list)
    return return_list
    
def get_preds(model, img_list, answer_data_list):
    print("Obtaining predictions from {}".format(model))
    pipe = pipeline("image-text-to-text", model=model, trust_remote_code=True, torch_dtype=torch.bfloat16, device_map="auto",)
    pipe.model.config.pad_token_id = pipe.tokenizer.eos_token_id

    data_size = len(img_list)
    prediction_list = [None for _ in range(data_size)]

    for i in range(data_size):
        print("Predicting sample {} of {}".format(i + 1, data_size))
        img = img_list[i]
        # take prompt from qn_list is there is no global user_prompt
        user_prompt = global_user_prompt.format(ref=answer_data_list[i], cand=all_model_caption(i))
        print(user_prompt)

        messages = [
            {"role": "system",
            "content": [{"type": "text", "text": system_prompt}]},
            {"role": "user",
            "content": [{"type": "image"}, {"type": "text", "text": user_prompt}]},
        ]

        raise TypeError
        output = pipe(images=img,
                    text=messages,
                    generate_kwargs={"max_new_tokens": 30},
                    return_full_text=False)

        prediction = output[0]['generated_text']
        prediction_list[i] = prediction

    return prediction_list


inputs = prep_data(ds_path=dataset_path, ds_split=dataset_split, split_size=sample_size)
predictions = {}

for model in models:
    img_list, qn_list, ref_list = split_inputs(inputs)

    prediction_list = get_preds(model=model, img_list=img_list, answer_data_list=ref_list)

    predictions[model] = prediction_list
print("prediction_list ({}): {}".format(model, prediction_list))

# show_individual(inputs, predictions, judge_evaluations=evaluations)

    